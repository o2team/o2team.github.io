<!DOCTYPE html><html class="theme-lattice"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><title>前端也要懂物理 —— 惯性滚动篇 | Aotu.io「凹凸实验室」</title><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="author" content="凹凸实验室"><meta name="designer" content="凹凸实验室"><meta name="rating" content="general"><meta name="format-detection" content="telephone=yes"><meta name="robots" content="index, follow"><meta baidu-gxt-verify-token="2b74a5aea155a215abea8547f929190c"><meta name="keywords" content="移动端 H5,UI 组件,惯性滚动,物理学,凹凸实验室,Aotu,前端开发,全栈开发,IOS开发,Android开发"><link rel="canonical" href="https://aotu.io/notes/2020/06/08/momentum-scrolling/index.html"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png"><link rel="icon" type="image/png" sizes="48x48" href="/img/favicon-48x48.png"><link rel="manifest" href="/img/manifest.json"><meta name="mobile-web-app-capable" content="yes"><meta name="theme-color" content="#2f83cd"><meta name="application-name" content="Aotu.io"><link rel="apple-touch-icon" sizes="57x57" href="/img/apple-touch-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/img/apple-touch-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/img/apple-touch-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/img/apple-touch-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/img/apple-touch-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/img/apple-touch-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/img/apple-touch-icon-152x152.png"><link rel="apple-touch-icon" sizes="167x167" href="/img/apple-touch-icon-167x167.png"><link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon-180x180.png"><link rel="apple-touch-icon" sizes="1024x1024" href="/img/apple-touch-icon-1024x1024.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="apple-mobile-web-app-title" content="Aotu.io"><meta name="msapplication-TileColor" content="#fff"><meta name="msapplication-TileImage" content="/img/mstile-144x144.png"><meta name="msapplication-config" content="/img/browserconfig.xml"><meta property="wb:webmaster" content="a1686eb81db284d5"><meta name="wechat-logo" content="https://img12.360buyimg.com/img/s400x400_jfs/t1/121890/1/4395/52691/5edf3c1cEc3f2f372/d77e336b50bc8375.png"><meta name="wechat-title" content="前端也要懂物理 —— 惯性滚动篇"><meta name="wechat-desc" content="惯性滚动最早出现在 iOS 系统中，旨在优化用户滑动页面的体验，现在已被各类终端环境所广泛应用，本文通过应用基础的物理模型来剖析惯性滚动在 web 环境的实现原理，并基于 vue 框架提供基本实现。"><link rel="dns-prefetch" href="//storage.360buyimg.com"><link rel="dns-prefetch" href="//img10.360buyimg.com"><link rel="dns-prefetch" href="//img11.360buyimg.com"><link rel="dns-prefetch" href="//img12.360buyimg.com"><link rel="dns-prefetch" href="//img13.360buyimg.com"><link rel="dns-prefetch" href="//img14.360buyimg.com"><link rel="dns-prefetch" href="//img20.360buyimg.com"><link rel="dns-prefetch" href="//img30.360buyimg.com"><link rel="dns-prefetch" href="//misc.aotu.io"><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"><link rel="stylesheet" href="/css/style.css"><link rel="alternate" href="/atom.xml" title="Aotu.io"><meta name="description" content="我们在平时编程开发时，除了需要关注技术实现、算法、代码效率等因素之外，更要把所学到的学科知识（如物理学、理论数学等等）灵活应用，毕竟理论和实践相辅相成、密不可分，这无论是对于我们的方案选型、还是技术实践理解都有非常大的帮助。今天就让我们一起来回顾中学物理知识，并灵活运用到惯性滚动的动效实现当中。 惯性滚动（也叫 滚动回弹，momentum-based scrolling）最早是出现在 iOS 系统"><meta name="keywords" content="物理学,惯性滚动,UI 组件,移动端 H5"><meta property="og:type" content="article"><meta property="og:title" content="前端也要懂物理 —— 惯性滚动篇"><meta property="og:url" content="https://aotu.io/notes/2020/06/08/momentum-scrolling/index.html"><meta property="og:site_name" content="Aotu.io"><meta property="og:description" content="我们在平时编程开发时，除了需要关注技术实现、算法、代码效率等因素之外，更要把所学到的学科知识（如物理学、理论数学等等）灵活应用，毕竟理论和实践相辅相成、密不可分，这无论是对于我们的方案选型、还是技术实践理解都有非常大的帮助。今天就让我们一起来回顾中学物理知识，并灵活运用到惯性滚动的动效实现当中。 惯性滚动（也叫 滚动回弹，momentum-based scrolling）最早是出现在 iOS 系统"><meta property="og:locale" content="zh-cn"><meta property="og:image" content="https://storage.360buyimg.com/ling-gif/1_1591633403251_173.gif"><meta property="og:image" content="https://img12.360buyimg.com/img/jfs/t1/120413/24/4522/2003463/5ede6e3aEc70a4e76/44fdfbb236023afe.gif"><meta property="og:image" content="https://img12.360buyimg.com/img/jfs/t1/135674/30/1792/1015829/5ede71ebEa52d996d/2b30bf4abedf9565.gif"><meta property="og:image" content="https://img12.360buyimg.com/img/jfs/t1/120072/29/4454/1023756/5ede72baEbb4bf501/99816824e9dcce8a.gif"><meta property="og:image" content="https://img12.360buyimg.com/img/s265x53_jfs/t1/133894/20/1859/1134/5ede7d7fE5732b7c6/b2bcae0e4785db9d.png"><meta property="og:image" content="https://img12.360buyimg.com/img/s264x68_jfs/t1/134807/39/1760/1131/5ede7dd4E0db49e81/47ddf6ca0818290c.png"><meta property="og:image" content="https://img12.360buyimg.com/img/s77x30_jfs/t1/123550/23/4382/885/5ede8396E803b9513/ad325baebf856a53.png"><meta property="og:image" content="https://img12.360buyimg.com/img/s57x33_jfs/t1/147227/24/251/773/5ede8475E55d55c32/5aa71d52c2c3097e.png"><meta property="og:image" content="https://img12.360buyimg.com/img/s68x33_jfs/t1/132476/4/1729/789/5ede873eEe7c6fa9f/d5d4a6ae8eba3383.png"><meta property="og:image" content="https://img12.360buyimg.com/img/s62x35_jfs/t1/137356/39/1742/842/5ede87d5E52dd3950/3f0c5861a8bacbd5.png"><meta property="og:image" content="https://img12.360buyimg.com/img/s50x36_jfs/t1/139756/32/262/752/5ede8895E0df4f6e0/96045c7dfadeb315.png"><meta property="og:image" content="https://img12.360buyimg.com/img/s95x34_jfs/t1/115211/21/9641/1208/5edeef98Eb1bdcb80/e2c881d9f60d2b12.png"><meta property="og:image" content="https://img12.360buyimg.com/img/s100x18_jfs/t1/112281/4/9764/1008/5edefbb5E1d957034/523aaeac82fd865f.png"><meta property="og:image" content="https://img12.360buyimg.com/img/s350x349_jfs/t1/132800/5/1832/13323/5edefd30E395dbfe3/f09150b02e194ad6.png"><meta property="og:image" content="https://img12.360buyimg.com/img/jfs/t1/146891/28/278/798915/5edefe63E0473ae1f/9e3084cb617d8f36.gif"><meta property="og:image" content="https://img12.360buyimg.com/img/s350x350_jfs/t1/147483/21/257/14064/5edeff10E5b0342b2/c19ab15cacfcff93.png"><meta property="og:image" content="https://img12.360buyimg.com/img/jfs/t1/143922/18/263/841326/5edeff5cE03e2c27a/5c5c0039d6cfc8d9.gif"><meta property="og:image" content="https://img12.360buyimg.com/img/s293x68_jfs/t1/121984/29/4358/1773/5edf04f7E5bf007c2/31bdc4c96c370e64.png"><meta property="og:image" content="https://img12.360buyimg.com/img/s293x68_jfs/t1/119416/13/8362/1800/5edf066bEc546e213/7a1938aa852db6af.png"><meta property="og:image" content="https://img12.360buyimg.com/img/s91x36_jfs/t1/137853/4/268/1283/5edf08d2E219e7af8/9cd93dca291f8881.png"><meta property="og:image" content="https://img12.360buyimg.com/img/s104x37_jfs/t1/128668/37/4401/1550/5edf0b47E2569110f/dc217d575e0d85a7.png"><meta property="og:image" content="https://img12.360buyimg.com/img/s107x20_jfs/t1/148859/23/246/1230/5edf1676E29d5eabd/81053843ad015066.png"><meta property="og:image" content="https://img12.360buyimg.com/img/s112x38_jfs/t1/121780/24/4432/1428/5edf17c3Ef65c9bfb/8bfdf3e58ed635a1.png"><meta property="og:image" content="https://img12.360buyimg.com/img/s905x323_jfs/t1/135000/38/1833/6723/5edf21aeE803e8081/01efb58ada451651.png"><meta property="og:image" content="https://img12.360buyimg.com/img/s657x323_jfs/t1/129414/19/4461/5193/5edf2270Eab9227ae/789bb4e119bbeae5.png"><meta property="og:image" content="https://img12.360buyimg.com/img/s350x349_jfs/t1/141070/7/291/35799/5edf25e1Eedd9ec05/18daa8ad67840883.png"><meta property="og:image" content="https://img12.360buyimg.com/img/jfs/t1/127474/10/4433/336458/5edf266aE83ac9cdf/e844e8e99e409836.gif"><meta property="og:image" content="https://img12.360buyimg.com/img/s349x350_jfs/t1/122474/9/4452/38669/5edf2755Ea44602ab/9a0ec7f74664fec5.png"><meta property="og:image" content="https://img12.360buyimg.com/img/jfs/t1/126992/23/4463/331517/5edf278eE02e02083/928538c867d9d519.gif"><meta property="og:updated_time" content="2021-02-02T07:48:05.250Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="前端也要懂物理 —— 惯性滚动篇"><meta name="twitter:description" content="我们在平时编程开发时，除了需要关注技术实现、算法、代码效率等因素之外，更要把所学到的学科知识（如物理学、理论数学等等）灵活应用，毕竟理论和实践相辅相成、密不可分，这无论是对于我们的方案选型、还是技术实践理解都有非常大的帮助。今天就让我们一起来回顾中学物理知识，并灵活运用到惯性滚动的动效实现当中。 惯性滚动（也叫 滚动回弹，momentum-based scrolling）最早是出现在 iOS 系统"><meta name="twitter:image" content="https://storage.360buyimg.com/ling-gif/1_1591633403251_173.gif"><meta name="twitter:site" content="o2circle"><script>var App={root:"/",isHome:!1,isCate:!1,isTag:!1}</script><script>window.WechatShareData={imgUrl:"https://img12.360buyimg.com/img/s400x400_jfs/t1/121890/1/4395/52691/5edf3c1cEc3f2f372/d77e336b50bc8375.png",link:window.location.href,title:"前端也要懂物理 —— 惯性滚动篇",desc:"惯性滚动最早出现在 iOS 系统中，旨在优化用户滑动页面的体验，现在已被各类终端环境所广泛应用，本文通过应用基础的物理模型来剖析惯性滚动在 web 环境的实现原理，并基于 vue 框架提供基本实现。"},window.WechatJSSDKURL="https://aotu.jd.com/aotu-wx-api/api/wx/jssdk/signature"</script></head><body class="page-post-detail"><div class="mod-hd"><div class="grid"><div class="mod-logo"><a href="/index.html" title="Aotu.io">Aotu.io</a></div><span class="mod-hd-toggle" id="J_hdToggle"><i class="fa fa-bars"></i></span><div class="mod-hd-main"><div class="mod-hd-inner"><nav class="mod-nav"><ul class="mod-nav-list"><li class="main-nav-item"><a href="/index.html" class="main-nav-link">首页</a></li><li class="main-nav-item"><a target="_blank" href="https://geeks.aotu.io" class="main-nav-link">极客沙龙</a></li><li class="main-nav-item"><a href="https://cases.aotu.io" class="main-nav-link">H5案例</a></li><li class="main-nav-item"><a href="/about/" class="main-nav-link">关于</a></li><li class="main-nav-item"><a href="/join/" class="main-nav-link">加入我们</a></li></ul></nav><div class="mod-search" id="J_search"><a class="fa fa-search mod-search-ico" id="J_searchTrigger" title="搜索"></a><form id="J_searchForm" method="get" class="mod-search-form" action="/search/"><input type="text" name="query" class="mod-search-ipt" id="J_searchInput" placeholder="搜索"></form></div></div></div></div></div><div class="mod-container"><div class="grid"><div class="mod-main typo"><article class="post"><div class="post-cover"><img src="https://img13.360buyimg.com/ling/jfs/t1/123424/14/4462/171235/5edf3a35Ea5c53dab/786c50df157ece8b.jpg" alt="前端也要懂物理 —— 惯性滚动篇"></div><header class="post-hd"><h1 class="post-tit">前端也要懂物理 —— 惯性滚动篇</h1><div class="post-meta">by <a target="_blank" href="https://github.com/JunreyCen" class="post-author">吖伟</a> on <span>2020-06-09</span></div><p class="post-subtit" style="display:none"><i class="fa fa-quote-left"></i>惯性滚动最早出现在 iOS 系统中，旨在优化用户滑动页面的体验，现在已被各类终端环境所广泛应用，本文通过应用基础的物理模型来剖析惯性滚动在 web 环境的实现原理，并基于 vue 框架提供基本实现。</p><span style="display:none" id="busuanzi_value_page_pv"></span></header><div class="post-content"><p>我们在平时编程开发时，除了需要关注技术实现、算法、代码效率等因素之外，更要把所学到的学科知识（如物理学、理论数学等等）灵活应用，毕竟理论和实践相辅相成、密不可分，这无论是对于我们的方案选型、还是技术实践理解都有非常大的帮助。今天就让我们一起来回顾中学物理知识，并灵活运用到惯性滚动的动效实现当中。</p><p><code>惯性滚动</code>（也叫 <code>滚动回弹</code>，<code>momentum-based scrolling</code>）最早是出现在 iOS 系统中，是指 <strong>当用户在终端上滑动页面然后把手指挪开，页面不会马上停下而是继续保持一定时间的滚动效果，并且滚动的速度和持续时间是与滑动手势的强烈程度成正比</strong>。抽象地理解，就像高速行驶的列车制动后依然会往前行驶一段距离才会最终停下。而且在 iOS 系统中，当页面滚动到顶/底部时，还有可能触发 “回弹” 的效果。这里录制了微信 APP 【账单】页面中的 iOS 原生时间选择器的惯性滚动效果：</p><p><img src="https://storage.360buyimg.com/ling-gif/1_1591633403251_173.gif" alt="微信原生 date-picker"></p><p>熟悉 CSS 开发的同学或许会知道，在 Safari 浏览器中有这样一条 CSS 规则：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">-webkit-overflow-scrolling</span>: <span class="selector-tag">touch</span>;</span><br></pre></td></tr></table></figure><p>当其样式值为 <code>touch</code> 时，浏览器会使用具有回弹效果的滚动, 即“当手指从触摸屏上移开，内容会继续保持一段时间的滚动效果”。除此之外，在丰富多姿的 web 前端生态中，很多经典组件的交互都一定程度地沿用了惯性滚动的效果，譬如下面提到的几个流行 H5 组件库中的例子。</p><h2 id="流行-UI-库效果" class="post-heading"><a href="#流行-UI-库效果" class="headerlink" title="流行 UI 库效果"></a>流行 UI 库效果<a class="post-anchor" href="#流行-UI-库效果" aria-hidden="true"></a></h2><p>为了方便对比，我们先来看看一个 H5 普通长列表在 iOS 系统下（开启了滚动回弹）的滚动表现：</p><p><img src="https://img12.360buyimg.com/img/jfs/t1/120413/24/4522/2003463/5ede6e3aEc70a4e76/44fdfbb236023afe.gif" alt="iOS 下长列表滚动表现"></p><ul><li><p><a href="https://weui.io/#picker" target="_blank" rel="noopener">weui</a> 的 picker 组件</p><p><img src="https://img12.360buyimg.com/img/jfs/t1/135674/30/1792/1015829/5ede71ebEa52d996d/2b30bf4abedf9565.gif" alt="weui picker"></p><p>明显可见，weui 选择器的惯性滚动效果非常弱，基本上手从屏幕上移开后滚动就很快停止了，体验较为不好。</p></li><li><p><a href="https://youzan.github.io/vant/mobile.html#/zh-CN/picker" target="_blank" rel="noopener">vant</a> 的 picker 组件</p><p><img src="https://img12.360buyimg.com/img/jfs/t1/120072/29/4454/1023756/5ede72baEbb4bf501/99816824e9dcce8a.gif" alt="vant picker"></p><p>相比之下，vant 选择器的惯性滚动效果则明显清晰得多，但是由于触顶/底回弹时依然维持了普通滚动时的系数或持续时间，导致整体来说回弹的效果有点脱节。</p></li></ul><h2 id="应用物理学模型" class="post-heading"><a href="#应用物理学模型" class="headerlink" title="应用物理学模型"></a>应用物理学模型<a class="post-anchor" href="#应用物理学模型" aria-hidden="true"></a></h2><p><code>惯性</code> 一词来源于物理学中的惯性定律（即 <a href="https://baike.baidu.com/item/%E7%89%9B%E9%A1%BF%E7%AC%AC%E4%B8%80%E8%BF%90%E5%8A%A8%E5%AE%9A%E5%BE%8B?fromtitle=%E6%83%AF%E6%80%A7%E5%AE%9A%E5%BE%8B&amp;fromid=452930" target="_blank" rel="noopener">牛顿第一定律</a>）：一切物体在没有受到力的作用的时候，运动状态不会发生改变，物体所拥有的这种性质就被称为惯性。可想而知，惯性滚动的本质就是物理学中的惯性现象，因此，我们可以恰当利用中学物理上的 <code>滑块模型</code> 来描述惯性滚动全过程。</p><p>为了方便描述，我们把浏览器惯性滚动效果中的滚动目标（如浏览器中的页面元素）模拟成滑块模型中的 <code>滑块</code>。而且分析得出，惯性滚动的全过程可以模拟为（人）使滑块滑动一定距离然后释放的过程，那么，全流程可以拆解为以下两个阶段：</p><ul><li><p>第一阶段，<strong>滑动滑块使其从静止开始做加速运动；</strong></p><p><img src="https://img12.360buyimg.com/img/s265x53_jfs/t1/133894/20/1859/1134/5ede7d7fE5732b7c6/b2bcae0e4785db9d.png" alt="滑块模型第一阶段"></p><p>在此阶段，滑块受到的 <code>F拉</code> 大于 <code>F摩</code> 使其从左到右匀加速前进。</p><blockquote><p>需要注意的是，对于浏览器的惯性滚动来说，我们一般关注的是用户即将释放手指前的一小阶段，而非滚动的全流程（全流程意义不大），这一瞬间阶段可以简单模拟为滑块均衡受力做 <a href="https://baike.baidu.com/item/%E5%8C%80%E5%8F%98%E9%80%9F%E7%9B%B4%E7%BA%BF%E8%BF%90%E5%8A%A8/8704911?fr=aladdin" target="_blank" rel="noopener">匀加速运动</a>。</p></blockquote></li><li><p>第二阶段，<strong>释放滑块使其在只受摩擦力的作用下继续滑动，直至最终静止；</strong></p><p><img src="https://img12.360buyimg.com/img/s264x68_jfs/t1/134807/39/1760/1131/5ede7dd4E0db49e81/47ddf6ca0818290c.png" alt="滑块模型第二阶段"></p><p>在此阶段，滑块只受到反向的摩擦力，会维持从左到右的运动方向减速前进然后停下。</p></li></ul><p>基于滑块模型，我们需要找到适合的量化指标来建立惯性滚动的计算体系。结合模型和具体实现，我们需要关注 <code>滚动距离</code>、<code>速度曲线</code> 以及 <code>滚动时长</code> 这几个关键指标，下面会一一展开解析。</p><h2 id="滚动距离" class="post-heading"><a href="#滚动距离" class="headerlink" title="滚动距离"></a>滚动距离<a class="post-anchor" href="#滚动距离" aria-hidden="true"></a></h2><p>对于滑动模型的第一阶段，滑块做匀加速运动，我们不妨设滑块的滑动距离为 <code>s1</code>，滑动的时间为 <code>t1</code>，结束时的临界点速度（末速度）为 <code>v1</code> ，根据位移公式</p><p><img src="https://img12.360buyimg.com/img/s77x30_jfs/t1/123550/23/4382/885/5ede8396E803b9513/ad325baebf856a53.png" alt="位移公式"></p><p>可以得出速度关系</p><p><img src="https://img12.360buyimg.com/img/s57x33_jfs/t1/147227/24/251/773/5ede8475E55d55c32/5aa71d52c2c3097e.png" alt="第一阶段末速度"></p><p>对于第二阶段，滑块受摩擦力 <code>F拉</code> 做匀减速运动，我们不妨设滑动距离为 <code>s2</code>，滑动的时间为 <code>t2</code>，滑动加速度为 <code>a</code>，另外初速度为 <code>v1</code>，末速度为 <code>0m/s</code>，结合位移公式和加速度公式</p><p><img src="https://img12.360buyimg.com/img/s68x33_jfs/t1/132476/4/1729/789/5ede873eEe7c6fa9f/d5d4a6ae8eba3383.png" alt="加速度公式"></p><p>可以推算出滑动距离 <code>s2</code></p><p><img src="https://img12.360buyimg.com/img/s62x35_jfs/t1/137356/39/1742/842/5ede87d5E52dd3950/3f0c5861a8bacbd5.png" alt="第二阶段滑动距离"></p><p>由于匀减速运动的加速度为负（即 <code>a &lt; 0</code>），不妨设一个加速度常量 <code>A</code>，使其满足 <code>A = -2a</code> 的关系，那么滑动距离</p><p><img src="https://img12.360buyimg.com/img/s50x36_jfs/t1/139756/32/262/752/5ede8895E0df4f6e0/96045c7dfadeb315.png" alt="第二阶段滑动距离和常量关系"></p><p>然而在浏览器实际应用时，<strong><code>v1</code> 算平方会导致最终计算出的惯性滚动距离太大（即对滚动手势的强度感应过于灵敏），我们不妨把平方运算去掉</strong>：</p><p><img src="https://img12.360buyimg.com/img/s95x34_jfs/t1/115211/21/9641/1208/5edeef98Eb1bdcb80/e2c881d9f60d2b12.png" alt="两阶段关系"></p><p>所以，求惯性滚动的距离（即 <code>s2</code>）时，我们只需要记录用户滚动的 <strong>距离 <code>s1</code></strong> 和 <strong>滚动时长 <code>t1</code></strong>，并设置一个合适的 <strong>加速度常量 <code>A</code></strong> 即可。</p><blockquote><p>经大量测试得出，加速度常量 <code>A</code> 的合适值为 <code>0.003</code>。</p></blockquote><p>另外，需要注意的是，对于真正的浏览器惯性滚动效果来说，这里讨论的滚动距离和时长是指能够作用于惯性滚动的范围内的距离和时长，而非用户滚动页面元素的全流程，详细的可以看【启停条件】这一节内容。</p><h2 id="惯性滚动速度曲线" class="post-heading"><a href="#惯性滚动速度曲线" class="headerlink" title="惯性滚动速度曲线"></a>惯性滚动速度曲线<a class="post-anchor" href="#惯性滚动速度曲线" aria-hidden="true"></a></h2><p>针对惯性滚动阶段，也就是第二阶段中的匀减速运动，根据位移公式可以得到位移差和时间间距 <code>T</code> 的关系</p><p><img src="https://img12.360buyimg.com/img/s100x18_jfs/t1/112281/4/9764/1008/5edefbb5E1d957034/523aaeac82fd865f.png" alt="位移差和时间关系"></p><p>不难得出，<strong>在同等时间间距条件下，相邻两段位移差会越来越小，换句话说就是惯性滚动的偏移量增加速度会越来越小</strong>。这与 CSS3 <code>transition-timing-function</code> 中的 <code>ease-out</code> 速度曲线非常吻合，<code>ease-out</code> （即 <code>cubic-bezier(0, 0, .58, 1)</code>）的贝塞尔曲线为</p><p><img src="https://img12.360buyimg.com/img/s350x349_jfs/t1/132800/5/1832/13323/5edefd30E395dbfe3/f09150b02e194ad6.png" alt="ease-out 贝塞尔曲线"></p><blockquote><p>曲线图来自 <a href="http://cubic-bezier.com/" target="_blank" rel="noopener">在线绘制贝塞尔曲线网站</a>。</p></blockquote><p>其中，图表中的纵坐标是指 <strong>动画推进的进程</strong>，横坐标是指 <strong>时间</strong>，原点坐标为 <code>(0, 0)</code>，终点坐标为 <code>(1, 1)</code>，假设动画持续时间为 2 秒，<code>(1, 1)</code> 坐标点则代表动画启动后 2 秒时动画执行完毕（100%）。根据图表可以得出，时间越往后动画进程的推进速度越慢，符合匀减速运动的特性。</p><p>我们试试实践应用 <code>ease-out</code> 速度曲线：</p><p><img src="https://img12.360buyimg.com/img/jfs/t1/146891/28/278/798915/5edefe63E0473ae1f/9e3084cb617d8f36.gif" alt="ease-out 曲线应用"></p><p>很明显，这样的速度曲线过于线性平滑，减速效果不明显。我们参考 iOS 滚动回弹的效果重复测试，调整贝塞尔曲线的参数为 <code>cubic-bezier(.17, .89, .45, 1)</code>：</p><p><img src="https://img12.360buyimg.com/img/s350x350_jfs/t1/147483/21/257/14064/5edeff10E5b0342b2/c19ab15cacfcff93.png" alt="调整后的贝塞尔曲线"></p><p>调整曲线后的效果理想很多：</p><p><img src="https://img12.360buyimg.com/img/jfs/t1/143922/18/263/841326/5edeff5cE03e2c27a/5c5c0039d6cfc8d9.gif" alt="调整后的曲线效果"></p><h2 id="回弹" class="post-heading"><a href="#回弹" class="headerlink" title="回弹"></a>回弹<a class="post-anchor" href="#回弹" aria-hidden="true"></a></h2><p>接下来模拟惯性滚动时触碰到容器边界触发回弹的情况。</p><p>我们基于滑块模型来模拟这样的场景：滑块左端与一根弹簧连接，弹簧另一端固定在墙体上，在滑块向右滑动的过程中，当滑块到达临界点（弹簧即将发生形变时）而速度还没有降到 <code>0m/s</code> 时，滑块会继续滑动并拉动弹簧使其发生形变，同时滑块会受到弹簧的反拉力作减速运动（动能转化为内能）；当滑块速度降为 <code>0m/s</code> 时，此时弹簧的形变量最大，由于弹性特质弹簧会恢复原状（内能转化成动能），并拉动滑块反向（左）运动。</p><p>类似地，回弹过程也可以分为下面两个阶段：</p><ul><li><p>滑块拉动弹簧往右做变减速运动；</p><p><img src="https://img12.360buyimg.com/img/s293x68_jfs/t1/121984/29/4358/1773/5edf04f7E5bf007c2/31bdc4c96c370e64.png" alt="回弹第一阶段模型"></p></li></ul><p>此阶段滑块受到摩擦力 <code>F摩</code> 和越来越大的弹簧拉力 <code>F弹</code> 共同作用，加速度越来越大，导致速度降为 <code>0m/s</code> 的时间会非常短。</p><ul><li><p>弹簧恢复原状，拉动滑块向左做先变加速后变减速运动；</p><p><img src="https://img12.360buyimg.com/img/s293x68_jfs/t1/119416/13/8362/1800/5edf066bEc546e213/7a1938aa852db6af.png" alt="回弹第二阶段模型"></p><p>此阶段滑块受到的摩擦力 <code>F摩</code> 和越来越小的弹簧拉力 <code>F弹</code> 相互抵消，刚开始 <code>F弹 &gt; F摩</code>，滑块做加速度越来越小的变加速运动；随后 <code>F弹 &lt; F摩</code>，滑块做加速度越来越大的变减速运动，直至最终静止。这里为了方便实际计算，我们不妨假设一个理想状态：<strong>当滑块静止时弹簧刚好恢复形变</strong>。</p></li></ul><h2 id="回弹距离" class="post-heading"><a href="#回弹距离" class="headerlink" title="回弹距离"></a>回弹距离<a class="post-anchor" href="#回弹距离" aria-hidden="true"></a></h2><p>根据上面的模型分析，回弹的第一阶段做加速度越来越大的变减速直线运动，不妨设此阶段的初速度为 <code>v0</code>，末速度为 <code>v1</code>，那么可以与滑块位移建立关系：</p><p><img src="https://img12.360buyimg.com/img/s91x36_jfs/t1/137853/4/268/1283/5edf08d2E219e7af8/9cd93dca291f8881.png" alt="回弹第一阶段位移"></p><p>其中 <code>a</code> 为加速度变量，这里暂不展开讨论。那么，根据物理学的弹性模型，第二阶段的回弹距离为</p><p><img src="https://img12.360buyimg.com/img/s104x37_jfs/t1/128668/37/4401/1550/5edf0b47E2569110f/dc217d575e0d85a7.png" alt="回弹第二阶段位移"></p><p>微积分都来了，简直没法计算……</p><p>然而，我们可以根据运动模型适当简化 <code>S回弹</code> 值的计算。由于 <code>回弹第二阶段的加速度</code> 是大于 <code>非回弹惯性滚动阶段的加速度</code>（<code>F弹 + F摩 &gt; F摩</code>）的，不妨设非回弹惯性滚动阶段的总距离为 <code>S滑</code>，那么</p><p><img src="https://img12.360buyimg.com/img/s107x20_jfs/t1/148859/23/246/1230/5edf1676E29d5eabd/81053843ad015066.png" alt="回弹距离关系"></p><p>因此，我们可以设置一个较为合理的常量 <code>B</code>，使其满足这样的等式：</p><p><img src="https://img12.360buyimg.com/img/s112x38_jfs/t1/121780/24/4432/1428/5edf17c3Ef65c9bfb/8bfdf3e58ed635a1.png" alt="回弹距离等式"></p><blockquote><p>经大量实践得出，常量 <code>B</code> 的合理值为 10。</p></blockquote><h2 id="回弹速度曲线" class="post-heading"><a href="#回弹速度曲线" class="headerlink" title="回弹速度曲线"></a>回弹速度曲线<a class="post-anchor" href="#回弹速度曲线" aria-hidden="true"></a></h2><p>触发回弹的整个惯性滚动轨迹可以拆分成三个运动阶段：</p><p><img src="https://img12.360buyimg.com/img/s905x323_jfs/t1/135000/38/1833/6723/5edf21aeE803e8081/01efb58ada451651.png" alt="触发回弹的运动轨迹"></p><p>然而，如果要把阶段 <code>a</code> 和阶段 <code>b</code> 准确描绘成 CSS 动画是有很高的复杂度的：</p><ul><li>阶段 <code>b</code> 中的变减速运动难以准确描绘；</li><li>这两个阶段虽运动方向相同但动画速度曲线不连贯，很容易造成用户体验断层；</li></ul><p>为了简化流程，我们把阶段 <code>a</code> 和 <code>b</code> 合并成一个运动阶段，那么简化后的轨迹就变成：</p><p><img src="https://img12.360buyimg.com/img/s657x323_jfs/t1/129414/19/4461/5193/5edf2270Eab9227ae/789bb4e119bbeae5.png" alt="简化后的回弹运动轨迹"></p><p>鉴于在阶段 <code>a</code> 末端的反向加速度会越来越大，所以此阶段滑块的速度骤减同比非回弹惯性滚动更快，对应的贝塞尔曲线末端就会更陡。我们选择一条较为合理的曲线 <code>cubic-bezier(.25, .46, .45, .94)</code>：</p><p><img src="https://img12.360buyimg.com/img/s350x349_jfs/t1/141070/7/291/35799/5edf25e1Eedd9ec05/18daa8ad67840883.png" alt="回弹阶段 a 曲线"></p><p>对于阶段 <code>b</code>，滑块先变加速后变减速，与 <code>ease-in-out</code> 的曲线有点类似，实践尝试：</p><p><img src="https://img12.360buyimg.com/img/jfs/t1/127474/10/4433/336458/5edf266aE83ac9cdf/e844e8e99e409836.gif" alt="ease-in-out 曲线实践"></p><p>仔细观察，我们发现阶段 <code>a</code> 和阶段 <code>b</code> 的衔接不够流畅，这是由于 <code>ease-in-out</code> 曲线的前半段缓入导致的。所以，为了突出效果我们选择只描绘变减速运动的阶段 <code>b</code> 末段。贝塞尔曲线调整为 <code>cubic-bezier(.165, .84, .44, 1)</code></p><p><img src="https://img12.360buyimg.com/img/s349x350_jfs/t1/122474/9/4452/38669/5edf2755Ea44602ab/9a0ec7f74664fec5.png" alt="调整后的贝塞尔曲线"></p><p>实践效果：</p><p><img src="https://img12.360buyimg.com/img/jfs/t1/126992/23/4463/331517/5edf278eE02e02083/928538c867d9d519.gif" alt="调整后的贝塞尔曲线实践"></p><blockquote><p>由于 gif 转格式导致部分掉帧，示例效果看起来会有点卡顿，建议直接体验 <a href="https://codepen.io/JunreyCen/pen/arRYem" target="_blank" rel="noopener">demo</a></p></blockquote><h2 id="CSS-动效时长" class="post-heading"><a href="#CSS-动效时长" class="headerlink" title="CSS 动效时长"></a>CSS 动效时长<a class="post-anchor" href="#CSS-动效时长" aria-hidden="true"></a></h2><p>我们对 iOS 的滚动回弹效果做多次测量，定义出体验良好的动效时长参数。在一次惯性滚动中，可能会出现下面两种情况，对应的动效时间也不一样：</p><ul><li><p><strong>没有触发回弹</strong></p><p>惯性滚动的合理持续时间为 <code>2500ms</code>。</p></li><li><p><strong>触发回弹</strong></p><p>对于阶段 <code>a</code>，当 <code>S回弹</code> 大于某个关键阈值时定义为 <strong>强回弹</strong>，动效时长为 <code>400ms</code>；反之则定义为 <strong>弱回弹</strong>，动效时长为 <code>800ms</code>。</p><p>而对于阶段 <code>b</code>，反弹的持续时间为 <code>500ms</code> 较为合理。</p></li></ul><h2 id="启停条件" class="post-heading"><a href="#启停条件" class="headerlink" title="启停条件"></a>启停条件<a class="post-anchor" href="#启停条件" aria-hidden="true"></a></h2><p>前文中有提到，如果把用户滚动页面元素的整个过程都纳入计算范围是非常不合理的。不难想象，当用户以非常缓慢的速度使元素滚动比较大的距离，这种情况下元素动量非常小，理应不触发惯性滚动。因此，惯性滚动的触发是有条件的。</p><ul><li><p><strong>启动条件</strong></p><p>惯性滚动的启动需要有足够的动量。我们可以简单地认为，当用户滚动的距离足够大（大于 <code>15px</code>）和持续时间足够短（小于 <code>300ms</code>）时，即可产生惯性滚动。换成编程语言就是，最后一次 <code>touchmove</code> 事件触发的时间和 <code>touchend</code> 事件触发的时间间隔小于 <code>300ms</code>，且两者产生的距离差大于 <code>15px</code> 时认为可启动惯性滚动。</p></li><li><p><strong>暂停时机</strong></p><p>当惯性滚动未结束（包括处于回弹过程），用户再次触碰滚动元素时，我们应该暂停元素的滚动。在实现原理上，我们需要通过 <code>getComputedStyle</code> 和 <code>getPropertyValue</code> 方法获取当前的 <code>transform: matrix()</code> 矩阵值，抽离出元素的水平 y 轴偏移量后重新调整 <code>translate</code> 的位置。</p></li></ul><h2 id="示例代码" class="post-heading"><a href="#示例代码" class="headerlink" title="示例代码"></a>示例代码<a class="post-anchor" href="#示例代码" aria-hidden="true"></a></h2><p>基于 vuejs 提供了部分关键代码，也可以直接访问 <a href="https://codepen.io/JunreyCen/pen/arRYem" target="_blank" rel="noopener">codepen demo</a> 体验效果（完整代码）。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">template</span> <span class="attr">id</span>=<span class="string">"tpl"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span></span></span><br><span class="line"><span class="tag">        <span class="attr">ref</span>=<span class="string">"wrapper"</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">touchstart.prevent</span>=<span class="string">"onStart"</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">touchmove.prevent</span>=<span class="string">"onMove"</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">touchend.prevent</span>=<span class="string">"onEnd"</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">touchcancel.prevent</span>=<span class="string">"onEnd"</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">transitionend</span>=<span class="string">"onTransitionEnd"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">ref</span>=<span class="string">"scroller"</span> <span class="attr">:style</span>=<span class="string">"scrollerStyle"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">"item in list"</span>&gt;</span>&#123;&#123;item&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="actionscript">        el: <span class="string">'#app'</span>,</span></span><br><span class="line"><span class="actionscript">        template: <span class="string">'#tpl'</span>,</span></span><br><span class="line">        computed: &#123;</span><br><span class="line">          list() &#123;&#125;,</span><br><span class="line">          scrollerStyle() &#123;</span><br><span class="line"><span class="actionscript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">              <span class="string">'transform'</span>: <span class="string">`translate3d(0, <span class="subst">$&#123;<span class="keyword">this</span>.offsetY&#125;</span>px, 0)`</span>,</span></span><br><span class="line"><span class="javascript">              <span class="string">'transition-duration'</span>: <span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.duration&#125;</span>ms`</span>,</span></span><br><span class="line"><span class="actionscript">              <span class="string">'transition-timing-function'</span>: <span class="keyword">this</span>.bezier,</span></span><br><span class="line">            &#125;;</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        data() &#123;</span><br><span class="line"><span class="actionscript">          <span class="keyword">return</span> &#123;</span></span><br><span class="line">            minY: 0,</span><br><span class="line">            maxY: 0,</span><br><span class="line">            wrapperHeight: 0,</span><br><span class="line">            duration: 0,</span><br><span class="line"><span class="actionscript">            bezier: <span class="string">'linear'</span>,</span></span><br><span class="line"><span class="actionscript">            pointY: <span class="number">0</span>,                    <span class="comment">// touchStart 手势 y 坐标</span></span></span><br><span class="line"><span class="actionscript">            startY: <span class="number">0</span>,                    <span class="comment">// touchStart 元素 y 偏移值</span></span></span><br><span class="line"><span class="actionscript">            offsetY: <span class="number">0</span>,                   <span class="comment">// 元素实时 y 偏移值</span></span></span><br><span class="line"><span class="actionscript">            startTime: <span class="number">0</span>,                 <span class="comment">// 惯性滑动范围内的 startTime</span></span></span><br><span class="line"><span class="actionscript">            momentumStartY: <span class="number">0</span>,            <span class="comment">// 惯性滑动范围内的 startY</span></span></span><br><span class="line"><span class="actionscript">            momentumTimeThreshold: <span class="number">300</span>,   <span class="comment">// 惯性滑动的启动 时间阈值</span></span></span><br><span class="line"><span class="actionscript">            momentumYThreshold: <span class="number">15</span>,       <span class="comment">// 惯性滑动的启动 距离阈值</span></span></span><br><span class="line"><span class="actionscript">            isStarted: <span class="literal">false</span>,             <span class="comment">// start锁</span></span></span><br><span class="line">          &#125;;</span><br><span class="line">        &#125;,</span><br><span class="line">        mounted() &#123;</span><br><span class="line"><span class="javascript">          <span class="keyword">this</span>.$nextTick(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">this</span>.wrapperHeight = <span class="keyword">this</span>.$refs.wrapper.getBoundingClientRect().height;</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">this</span>.minY = <span class="keyword">this</span>.wrapperHeight - <span class="keyword">this</span>.$refs.scroller.getBoundingClientRect().height;</span></span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line">          onStart(e) &#123;</span><br><span class="line"><span class="actionscript">            <span class="keyword">const</span> point = e.touches ? e.touches[<span class="number">0</span>] : e;</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">this</span>.isStarted = <span class="literal">true</span>;</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">this</span>.duration = <span class="number">0</span>;</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">this</span>.stop();</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">this</span>.pointY = point.pageY;</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">this</span>.momentumStartY = <span class="keyword">this</span>.startY = <span class="keyword">this</span>.offsetY;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">this</span>.startTime = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</span></span><br><span class="line">          &#125;,</span><br><span class="line">          onMove(e) &#123;</span><br><span class="line"><span class="actionscript">            <span class="keyword">if</span> (!<span class="keyword">this</span>.isStarted) <span class="keyword">return</span>;</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">const</span> point = e.touches ? e.touches[<span class="number">0</span>] : e;</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">const</span> deltaY = point.pageY - <span class="keyword">this</span>.pointY;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">this</span>.offsetY = <span class="built_in">Math</span>.round(<span class="keyword">this</span>.startY + deltaY);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> now = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</span></span><br><span class="line"><span class="actionscript">            <span class="comment">// 记录在触发惯性滑动条件下的偏移值和时间</span></span></span><br><span class="line"><span class="actionscript">            <span class="keyword">if</span> (now - <span class="keyword">this</span>.startTime &gt; <span class="keyword">this</span>.momentumTimeThreshold) &#123;</span></span><br><span class="line"><span class="actionscript">              <span class="keyword">this</span>.momentumStartY = <span class="keyword">this</span>.offsetY;</span></span><br><span class="line"><span class="actionscript">              <span class="keyword">this</span>.startTime = now;</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          onEnd(e) &#123;</span><br><span class="line"><span class="actionscript">            <span class="keyword">if</span> (!<span class="keyword">this</span>.isStarted) <span class="keyword">return</span>;</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">this</span>.isStarted = <span class="literal">false</span>;</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">if</span> (<span class="keyword">this</span>.isNeedReset()) <span class="keyword">return</span>;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> absDeltaY = <span class="built_in">Math</span>.abs(<span class="keyword">this</span>.offsetY - <span class="keyword">this</span>.momentumStartY);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> duration = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime() - <span class="keyword">this</span>.startTime;</span></span><br><span class="line"><span class="actionscript">            <span class="comment">// 启动惯性滑动</span></span></span><br><span class="line"><span class="actionscript">            <span class="keyword">if</span> (duration &lt; <span class="keyword">this</span>.momentumTimeThreshold &amp;&amp; absDeltaY &gt; <span class="keyword">this</span>.momentumYThreshold) &#123;</span></span><br><span class="line"><span class="actionscript">              <span class="keyword">const</span> momentum = <span class="keyword">this</span>.momentum(<span class="keyword">this</span>.offsetY, <span class="keyword">this</span>.momentumStartY, duration);</span></span><br><span class="line"><span class="javascript">              <span class="keyword">this</span>.offsetY = <span class="built_in">Math</span>.round(momentum.destination);</span></span><br><span class="line"><span class="actionscript">              <span class="keyword">this</span>.duration = momentum.duration;</span></span><br><span class="line"><span class="actionscript">              <span class="keyword">this</span>.bezier = momentum.bezier;</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          onTransitionEnd() &#123;</span><br><span class="line"><span class="actionscript">            <span class="keyword">this</span>.isNeedReset();</span></span><br><span class="line">          &#125;,</span><br><span class="line">          momentum(current, start, duration) &#123;</span><br><span class="line"><span class="actionscript">            <span class="keyword">const</span> durationMap = &#123;</span></span><br><span class="line"><span class="actionscript">              <span class="string">'noBounce'</span>: <span class="number">2500</span>,</span></span><br><span class="line"><span class="actionscript">              <span class="string">'weekBounce'</span>: <span class="number">800</span>,</span></span><br><span class="line"><span class="actionscript">              <span class="string">'strongBounce'</span>: <span class="number">400</span>,</span></span><br><span class="line">            &#125;;</span><br><span class="line"><span class="actionscript">            <span class="keyword">const</span> bezierMap = &#123;</span></span><br><span class="line"><span class="actionscript">              <span class="string">'noBounce'</span>: <span class="string">'cubic-bezier(.17, .89, .45, 1)'</span>,</span></span><br><span class="line"><span class="actionscript">              <span class="string">'weekBounce'</span>: <span class="string">'cubic-bezier(.25, .46, .45, .94)'</span>,</span></span><br><span class="line"><span class="actionscript">              <span class="string">'strongBounce'</span>: <span class="string">'cubic-bezier(.25, .46, .45, .94)'</span>,</span></span><br><span class="line">            &#125;;</span><br><span class="line"><span class="javascript">            <span class="keyword">let</span> type = <span class="string">'noBounce'</span>;</span></span><br><span class="line"><span class="actionscript">            <span class="comment">// 惯性滑动加速度</span></span></span><br><span class="line"><span class="actionscript">            <span class="keyword">const</span> deceleration = <span class="number">0.003</span>;</span></span><br><span class="line"><span class="actionscript">            <span class="comment">// 回弹阻力</span></span></span><br><span class="line"><span class="actionscript">            <span class="keyword">const</span> bounceRate = <span class="number">10</span>;</span></span><br><span class="line"><span class="actionscript">            <span class="comment">// 强弱回弹的分割值</span></span></span><br><span class="line"><span class="actionscript">            <span class="keyword">const</span> bounceThreshold = <span class="number">300</span>;</span></span><br><span class="line"><span class="actionscript">            <span class="comment">// 回弹的最大限度</span></span></span><br><span class="line"><span class="actionscript">            <span class="keyword">const</span> maxOverflowY = <span class="keyword">this</span>.wrapperHeight / <span class="number">6</span>;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">let</span> overflowY;</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">            <span class="keyword">const</span> distance = current - start;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> speed = <span class="number">2</span> * <span class="built_in">Math</span>.abs(distance) / duration;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">let</span> destination = current + speed / deceleration * (distance &lt; <span class="number">0</span> ? <span class="number">-1</span> : <span class="number">1</span>);</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">if</span> (destination &lt; <span class="keyword">this</span>.minY) &#123;</span></span><br><span class="line"><span class="actionscript">              overflowY = <span class="keyword">this</span>.minY - destination;</span></span><br><span class="line"><span class="actionscript">              type = overflowY &gt; bounceThreshold ? <span class="string">'strongBounce'</span> : <span class="string">'weekBounce'</span>;</span></span><br><span class="line"><span class="javascript">              destination = <span class="built_in">Math</span>.max(<span class="keyword">this</span>.minY - maxOverflowY, <span class="keyword">this</span>.minY - overflowY / bounceRate);</span></span><br><span class="line"><span class="actionscript">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (destination &gt; <span class="keyword">this</span>.maxY) &#123;</span></span><br><span class="line"><span class="actionscript">              overflowY = destination - <span class="keyword">this</span>.maxY;</span></span><br><span class="line"><span class="actionscript">              type = overflowY &gt; bounceThreshold ? <span class="string">'strongBounce'</span> : <span class="string">'weekBounce'</span>;</span></span><br><span class="line"><span class="javascript">              destination = <span class="built_in">Math</span>.min(<span class="keyword">this</span>.maxY + maxOverflowY, <span class="keyword">this</span>.maxY + overflowY / bounceRate);</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line">              destination,</span><br><span class="line">              duration: durationMap[type],</span><br><span class="line">              bezier: bezierMap[type],</span><br><span class="line">            &#125;;</span><br><span class="line">          &#125;,</span><br><span class="line"><span class="actionscript">          <span class="comment">// 超出边界时需要重置位置</span></span></span><br><span class="line">          isNeedReset() &#123;</span><br><span class="line"><span class="javascript">            <span class="keyword">let</span> offsetY;</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">if</span> (<span class="keyword">this</span>.offsetY &lt; <span class="keyword">this</span>.minY) &#123;</span></span><br><span class="line"><span class="actionscript">              offsetY = <span class="keyword">this</span>.minY;</span></span><br><span class="line"><span class="actionscript">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.offsetY &gt; <span class="keyword">this</span>.maxY) &#123;</span></span><br><span class="line"><span class="actionscript">              offsetY = <span class="keyword">this</span>.maxY;</span></span><br><span class="line">            &#125;</span><br><span class="line"><span class="actionscript">            <span class="keyword">if</span> (<span class="keyword">typeof</span> offsetY !== <span class="string">'undefined'</span>) &#123;</span></span><br><span class="line"><span class="actionscript">              <span class="keyword">this</span>.offsetY = offsetY;</span></span><br><span class="line"><span class="actionscript">              <span class="keyword">this</span>.duration = <span class="number">500</span>;</span></span><br><span class="line"><span class="actionscript">              <span class="keyword">this</span>.bezier = <span class="string">'cubic-bezier(.165, .84, .44, 1)'</span>;</span></span><br><span class="line"><span class="actionscript">              <span class="keyword">return</span> <span class="literal">true</span>;</span></span><br><span class="line">            &#125;</span><br><span class="line"><span class="actionscript">            <span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line">          &#125;,</span><br><span class="line"><span class="actionscript">          <span class="comment">// 停止滚动</span></span></span><br><span class="line">          stop() &#123;</span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> matrix = <span class="built_in">window</span>.getComputedStyle(<span class="keyword">this</span>.$refs.scroller).getPropertyValue(<span class="string">'transform'</span>);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">this</span>.offsetY = <span class="built_in">Math</span>.round(+matrix.split(<span class="string">')'</span>)[<span class="number">0</span>].split(<span class="string">', '</span>)[<span class="number">5</span>]);</span></span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="参考资料" class="post-heading"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料<a class="post-anchor" href="#参考资料" aria-hidden="true"></a></h2><ul><li><a href="https://github.com/Tencent/weui.js/blob/master/src/picker/scroll.js" target="_blank" rel="noopener">weui-picker</a></li><li><a href="https://ustbhuangyi.github.io/better-scroll/doc/" target="_blank" rel="noopener">better-scroll</a></li></ul><div class="post-tags" style="display:none"><a href="/tags/物理学/">物理学</a> <a href="/tags/惯性滚动/">惯性滚动</a> <a href="/tags/UI-组件/">UI 组件</a> <a href="/tags/移动端-H5/">移动端 H5</a></div><div class="post-categories" style="display:none"><a href="/cates/web-开发/">web 开发</a></div><div class="post-announce">感谢您的阅读，本文由 <a href="//aotu.io">凹凸实验室</a> 版权所有。如若转载，请注明出处：凹凸实验室（<a href="https://aotu.io/notes/2020/06/08/momentum-scrolling/">https://aotu.io/notes/2020/06/08/momentum-scrolling/</a>）</div><div class="post-revision"><i class="fa fa-clock-o"></i> <time class="post-updated" datetime="2021-02-02T07:48:05.250Z">上次更新：2021-02-02 15:48:05</time></div></div><div class="post-nav"><div class="post-nav-next"><a href="/notes/2020/06/09/strong-svg/" title="向强大的SVG迈进">向强大的SVG迈进 <i class="fa fa-chevron-right"></i></a></div><div class="post-nav-prev"><a href="/notes/2020/06/07/sql-to-mongo-2/" title="从 SQL 到 MongoDB 之聚合篇"><i class="fa fa-chevron-left"></i> 从 SQL 到 MongoDB 之聚合篇</a></div></div><div class="post-comments" id="comments"></div><script>var gitalkOpts={id:"bm90ZXMvMjAyMC8wNi8wOC9tb21lbnR1bS1zY3JvbGxpbmcv",owner:"o2team",repo:"o2team.github.io",title:"前端也要懂物理 —— 惯性滚动篇",body:"https://aotu.io/notes/2020/06/08/momentum-scrolling/index.html\n\n惯性滚动最早出现在 iOS 系统中，旨在优化用户滑动页面的体验，现在已被各类终端环境所广泛应用，本文通过应用基础的物理模型来剖析惯性滚动在 web 环境的实现原理，并基于 vue 框架提供基本实现。",clientID:"3c4d153e6874260f9c7e",clientSecret:"dd44012504c6168bc05b9266e0554bb28c62ce15",admin:["JunreyCen"]}</script></article></div><aside class="mod-side" id="sidebar"><div class="mod-side-sec aotuwx"><img class="aotuwx-qrcode" src="/img/qrcode.jpg" alt="关注我们"><div class="aotuwx-slogan">每周推送精选技术文章</div></div><div class="mod-side-sec works"><div class="mod-side-sec-hd"><h2>服务/产品</h2></div><div class="mod-side-sec-bd"><ul class="mod-side-list"><li><a href="//taro.jd.com" target="_blank" title="Taro">Taro</a></li><li><a href="//taro-ui.jd.com" target="_blank" title="Taro-UI">Taro-UI</a></li><li><a href="//taro-ext.jd.com" target="_blank" title="Taro 物料市场">Taro 物料市场</a></li><li><a href="//taro-club.jd.com" target="_blank" title="Taro 官方论坛">Taro 官方论坛</a></li><li><a href="//cases.aotu.io/mobi/maga.html" target="_blank" title="拇指期刊">拇指期刊</a></li><li><a href="//athena.aotu.io/" target="_blank" title="Athena">Athena</a></li><li><a href="//guide.aotu.io/" target="_blank" title="前端代码规范">前端代码规范</a></li><li><a href="//halojs.aotu.io/" target="_blank" title="HaloJS">HaloJS</a></li><li><a href="//sign.aotu.io/" target="_blank" title="邮件签名工具">邮件签名工具</a></li><li><a href="//mac.aotu.io/" target="_blank" title="MAC全栈环境">MAC全栈环境</a></li><li><a href="//xcel.aotu.io" target="_blank" title="Excel Filter">Excel Filter</a></li><li><a href="//aotu.jd.com/share/" target="_blank" title="凹凸公开课">凹凸公开课</a></li><li><a href="//at.aotu.io" target="_blank" title="AT-UI">AT-UI</a></li></ul></div></div><div class="mod-side-sec favlinks"><div class="mod-side-sec-hd"><h2>友情链接</h2></div><div class="mod-side-sec-bd"><ul class="mod-side-list"><li><a href="https://www.cloudbase.net" target="_blank" title="小程序·云开发"><img style="width:22px;vertical-align:middle" src="https://img20.360buyimg.com/ling/jfs/t1/57175/5/15617/50216/5dca6729E00cdff5d/631622525425290e.png">小程序·云开发</a></li><li><a href="https://ling.jd.com" target="_blank" title="京东羚珑智能设计">羚珑智能设计</a></li><li><a href="https://jdrd.jd.com" target="_blank" title="京东零售设计服务平台">京东零售设计服务平台</a></li><li><a href="https://jdc.jd.com" target="_blank" title="京东设计中心">JDC京东设计中心</a></li><li><a href="http://dopro.io/" target="_blank" title="腾讯 Deep Ocean">Deep Ocean</a></li><li><a href="http://fex.baidu.com" target="_blank" title="百度Web前端研发部">百度FEX</a></li><li><a href="http://taobaofed.org" target="_blank" title="淘宝前端团队">淘宝FED</a></li><li><a href="http://tgideas.qq.com" target="_blank" title="腾讯互娱设计中心">TGIdeas</a></li><li><a href="http://isux.tencent.com" target="_blank" title="腾讯SNG设计中心">ISUX</a></li><li><a href="http://cdc.tencent.com" target="_blank" title="腾讯用户研究与体验设计中心">CDC</a></li><li><a href="http://ued.ctrip.com" target="_blank" title="携程设计委员会">携程UED</a></li><li><a href="https://uiiiuiii.com/" target="_blank" title="优优教程网">优优教程网</a></li><li><a href="https://www.designup.cn/" target="_blank" title="Designup">Designup</a></li><li><a href="http://eux.baidu.com/" target="_blank" title="百度EUX">百度EUX</a></li></ul></div></div></aside></div></div><div class="mod-backtop" id="backTop"><i class="fa fa-long-arrow-up"></i></div><footer class="mod-ft" id="footer"><div class="grid"><ul class="mod-ft-links"><li><a href="/atom.xml"><i class="fa fa-rss"></i></a></li><li><a href="https://github.com/o2team/o2team.github.io" target="_blank"><i class="fa fa-github-alt"></i></a></li></ul><div class="mod-ft-sec mod-ft-copyright"><p>Designed by <a href="http://aotu.io" target="_blank">凹凸实验室</a> @<a target="_blank" href="http://jdc.jd.com">京东用户体验设计部</a></p><p>Copyright &copy; 2021. All Rights Reserved.</p><p><a href="https://beian.miit.gov.cn/" target="_blank">粤ICP备15077732号-2</a></p></div></div></footer><script src="/js/bundle/core.js"></script><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script><script src="/js/post_wx_share.js"></script><script src="/js/bundle/gitalk.js"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?e850b980d029480b092fdd7503c3f8de";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script type="text/javascript" src="https://tajs.qq.com/stats?sId=53685723" charset="UTF-8"></script></body></html>