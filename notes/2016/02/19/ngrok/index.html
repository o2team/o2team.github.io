<!DOCTYPE html><html class="theme-lattice"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><title>手把手教你搭建ngrok服务－轻松外网调试本机站点 | Aotu.io「凹凸实验室」</title><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="author" content="凹凸实验室"><meta name="designer" content="凹凸实验室"><meta name="rating" content="general"><meta name="format-detection" content="telephone=yes"><meta name="robots" content="index, follow"><meta baidu-gxt-verify-token="2b74a5aea155a215abea8547f929190c"><meta name="keywords" content="调试,反向代理,ngrok,凹凸实验室,Aotu,前端开发,全栈开发,IOS开发,Android开发"><link rel="canonical" href="https://aotu.io/notes/2016/02/19/ngrok/index.html"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png"><link rel="icon" type="image/png" sizes="48x48" href="/img/favicon-48x48.png"><link rel="manifest" href="/img/manifest.json"><meta name="mobile-web-app-capable" content="yes"><meta name="theme-color" content="#2f83cd"><meta name="application-name" content="Aotu.io"><link rel="apple-touch-icon" sizes="57x57" href="/img/apple-touch-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/img/apple-touch-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/img/apple-touch-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/img/apple-touch-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/img/apple-touch-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/img/apple-touch-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/img/apple-touch-icon-152x152.png"><link rel="apple-touch-icon" sizes="167x167" href="/img/apple-touch-icon-167x167.png"><link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon-180x180.png"><link rel="apple-touch-icon" sizes="1024x1024" href="/img/apple-touch-icon-1024x1024.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="apple-mobile-web-app-title" content="Aotu.io"><meta name="msapplication-TileColor" content="#fff"><meta name="msapplication-TileImage" content="/img/mstile-144x144.png"><meta name="msapplication-config" content="/img/browserconfig.xml"><meta property="wb:webmaster" content="a1686eb81db284d5"><link rel="dns-prefetch" href="//storage.360buyimg.com"><link rel="dns-prefetch" href="//img10.360buyimg.com"><link rel="dns-prefetch" href="//img11.360buyimg.com"><link rel="dns-prefetch" href="//img12.360buyimg.com"><link rel="dns-prefetch" href="//img13.360buyimg.com"><link rel="dns-prefetch" href="//img14.360buyimg.com"><link rel="dns-prefetch" href="//img20.360buyimg.com"><link rel="dns-prefetch" href="//img30.360buyimg.com"><link rel="dns-prefetch" href="//misc.aotu.io"><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"><link rel="stylesheet" href="/css/style.css"><link rel="alternate" href="/atom.xml" title="Aotu.io"><meta name="description" content="半年多没用ngrok，然后昨天发现它被墙了，艸～。"><meta name="keywords" content="ngrok,反向代理,调试"><meta property="og:type" content="article"><meta property="og:title" content="手把手教你搭建ngrok服务－轻松外网调试本机站点"><meta property="og:url" content="https://aotu.io/notes/2016/02/19/ngrok/index.html"><meta property="og:site_name" content="Aotu.io"><meta property="og:description" content="半年多没用ngrok，然后昨天发现它被墙了，艸～。"><meta property="og:locale" content="zh-cn"><meta property="og:image" content="https://img10.360buyimg.com/ling/jfs/t1/36495/29/12573/67953/5d084babEb3dd1d1b/bf53f49b77fb1016.jpg"><meta property="og:image" content="https://img10.360buyimg.com/ling/jfs/t1/54563/16/2710/46427/5d084bc9E84e5e228/92c7342a06da7a14.jpg"><meta property="og:updated_time" content="2021-02-02T07:48:05.234Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="手把手教你搭建ngrok服务－轻松外网调试本机站点"><meta name="twitter:description" content="半年多没用ngrok，然后昨天发现它被墙了，艸～。"><meta name="twitter:image" content="https://img10.360buyimg.com/ling/jfs/t1/36495/29/12573/67953/5d084babEb3dd1d1b/bf53f49b77fb1016.jpg"><meta name="twitter:site" content="o2circle"><script>var App={root:"/",isHome:!1,isCate:!1,isTag:!1}</script></head><body class="page-post-detail"><div class="mod-hd"><div class="grid"><div class="mod-logo"><a href="/index.html" title="Aotu.io">Aotu.io</a></div><span class="mod-hd-toggle" id="J_hdToggle"><i class="fa fa-bars"></i></span><div class="mod-hd-main"><div class="mod-hd-inner"><nav class="mod-nav"><ul class="mod-nav-list"><li class="main-nav-item"><a href="/index.html" class="main-nav-link">首页</a></li><li class="main-nav-item"><a target="_blank" href="https://geeks.aotu.io" class="main-nav-link">极客沙龙</a></li><li class="main-nav-item"><a href="https://cases.aotu.io" class="main-nav-link">H5案例</a></li><li class="main-nav-item"><a href="/about/" class="main-nav-link">关于</a></li><li class="main-nav-item"><a href="/join/" class="main-nav-link">加入我们</a></li></ul></nav><div class="mod-search" id="J_search"><a class="fa fa-search mod-search-ico" id="J_searchTrigger" title="搜索"></a><form id="J_searchForm" method="get" class="mod-search-form" action="/search/"><input type="text" name="query" class="mod-search-ipt" id="J_searchInput" placeholder="搜索"></form></div></div></div></div></div><div class="mod-container"><div class="grid"><div class="mod-main typo"><article class="post"><div class="post-cover"><img src="//img12.360buyimg.com/ling/jfs/t1/58929/24/2535/40665/5d077c39Ebcd1eb57/8855058096a40d86.jpg" alt="手把手教你搭建ngrok服务－轻松外网调试本机站点"></div><header class="post-hd"><h1 class="post-tit">手把手教你搭建ngrok服务－轻松外网调试本机站点</h1><div class="post-meta">by <a target="_blank" href="https://github.com/mamboer" class="post-author">LV主唱大人</a> on <span>2016-02-19</span></div><p class="post-subtit" style="display:none"><i class="fa fa-quote-left"></i>ngrok的核心功能：能够将你本机的HTTP服务（站点）或TCP服务，通过部署有ngrok服务的外网伺服器暴露给外网访问！</p><span style="display:none" id="busuanzi_value_page_pv"></span></header><div class="post-content"><p>半年多没用ngrok，然后昨天发现它被墙了，艸～。</p><a id="more"></a><h2 id="ngrok是什么鬼？" class="post-heading"><a href="#ngrok是什么鬼？" class="headerlink" title="ngrok是什么鬼？"></a>ngrok是什么鬼？<a class="post-anchor" href="#ngrok是什么鬼？" aria-hidden="true"></a></h2><p>做前端开发的童鞋或许不会太陌生。<br>如果你完全不知道它是什么东西，可以在它的github项目上了解下：<a href="https://github.com/inconshreveable/ngrok" target="_blank" rel="noopener">https://github.com/inconshreveable/ngrok</a><br>这里只提下它的核心功能：能够将你本机的HTTP服务（站点）或TCP服务，通过部署有ngrok服务的外网伺服器暴露给外网访问！</p><p>如上封面图所示，举一个栗子。</p><ol><li>橘色屏幕的笔记本是你的工作机器，安装了ngrok客户端</li><li>ngrok.com所在的服务器安装了ngrok的服务端（ngrokd）</li><li>利用ngrok 8080命令可以将你本机的8080端口暴露给反向代理至ngrok.com的某个二级域名如：xxx.ngrok.com</li><li>别人通过xxx.ngrok.com就可以访问你本机8080端口上的站点内容了。</li></ol><p>由此可见，除了Weinre、browsersync 这些惯用的手段外，借助ngrok，也一样可以解决前端开发过程经常遇到的“本地开发，外网调试”老大难题。</p><p>囧的是：ngrok.com被墙了，我们已无法用它官方的服务～<br>国内虽然有一些第三方的ngrok服务，但是也无法保证其稳定性。<br>还好ngrok是开源的，我们可以通过它的源码在自己的外网服务器上搭建自己的ngrok服务。</p><p>前提条件是：一台外网可访问的主机，且有域名解析至该主机上。</p><h2 id="搭建服务端ngrokd" class="post-heading"><a href="#搭建服务端ngrokd" class="headerlink" title="搭建服务端ngrokd"></a>搭建服务端ngrokd<a class="post-anchor" href="#搭建服务端ngrokd" aria-hidden="true"></a></h2><h3 id="1-安装go语言开发环境" class="post-heading"><a href="#1-安装go语言开发环境" class="headerlink" title="1.安装go语言开发环境"></a>1.安装go语言开发环境<a class="post-anchor" href="#1-安装go语言开发环境" aria-hidden="true"></a></h3><p>ngrok是利用go语言开发的，所以先要在服务器上安装go语言开发环境。<br>以CentOS的服务器示例，安装Go语言很简单的：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install golang</span><br></pre></td></tr></table></figure><p>安装完毕后，利用go version来验证是否安装成功。<br>go安装好后，我们再设置下go的环境变量：</p><p>在<code>~/.zshrc</code>或<code>~/.bash_profile</code>文件内，加入以下环境变量配置内容：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> GOPATH=<span class="variable">$HOME</span>/go</span><br><span class="line">PATH=<span class="variable">$PATH</span>:<span class="variable">$HOME</span>/.<span class="built_in">local</span>/bin:<span class="variable">$HOME</span>/bin:<span class="variable">$GOPATH</span>/bin</span><br></pre></td></tr></table></figure><p>保存后，重新给shell加载下配置文件：<code>source ~/.zshrc</code></p><p>最后可通过go env查看是否配置成功。</p><h3 id="2-安装git" class="post-heading"><a href="#2-安装git" class="headerlink" title="2.安装git"></a>2.安装git<a class="post-anchor" href="#2-安装git" aria-hidden="true"></a></h3><p>安装过程略。后面我们需要利用git拉取源码。</p><h3 id="3-fork并拉取ngrok的源码" class="post-heading"><a href="#3-fork并拉取ngrok的源码" class="headerlink" title="3.fork并拉取ngrok的源码"></a>3.fork并拉取ngrok的源码<a class="post-anchor" href="#3-fork并拉取ngrok的源码" aria-hidden="true"></a></h3><p>下面编译过程需要改官方的部分源码，所以最好fork一份源码至自己的github账户。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir -p ~/go/src/github.com/mamboer</span><br><span class="line">$ <span class="built_in">cd</span> ~/go/src/github.com/mamboer</span><br><span class="line">$ git <span class="built_in">clone</span> https://github.com/mamboer/ngrok.git</span><br></pre></td></tr></table></figure><p>源码拉取下来后，需要修改一个地方：<br>打开<code>src/ngrok/log/logger.go</code>文件<br>将<code>code.google.com/p/log4go</code> 修改为：<code>github.com/alecthomas/log4go</code></p><p>googlecode已经寿终了，我们将依赖的log4go替换成github的版本。</p><p>在编译ngrok的源码之前，我们还需要改下官方源码用到的签名证书。</p><h3 id="4-生成自签名证书" class="post-heading"><a href="#4-生成自签名证书" class="headerlink" title="4.生成自签名证书"></a>4.生成自签名证书<a class="post-anchor" href="#4-生成自签名证书" aria-hidden="true"></a></h3><p>使用ngrok.com官方服务时，我们使用的是官方的SSL证书。自建ngrokd服务，如果不想买SSL证书，我们需要生成自己的自签名证书，并编译一个携带该证书的ngrok客户端。</p><p>证书生成过程需要一个NGROK_BASE_DOMAIN。 以ngrok官方随机生成的地址693c358d.ngrok.com为例，其NGROK_BASE_DOMAIN就是”ngrok.com”，如果你要 提供服务的地址为”example.ngrok.xxx.com”，那NGROK_BASE_DOMAIN就应该 是”ngrok.xxx.com”。</p><p>我们这里以NGROK_BASE_DOMAIN=“ngrok.fex.im”为例，生成证书的命令如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> ngrok</span><br><span class="line">$ openssl genrsa -out rootCA.key 2048</span><br><span class="line">$ openssl req -x509 -new -nodes -key rootCA.key -subj <span class="string">"/CN=ngrok.fex.im"</span> -days 5000 -out rootCA.pem</span><br><span class="line">$ openssl genrsa -out device.key 2048</span><br><span class="line">$ openssl req -new -key device.key -subj <span class="string">"/CN=ngrok.fex.im"</span> -out device.csr</span><br><span class="line">$ openssl x509 -req -<span class="keyword">in</span> device.csr -CA rootCA.pem -CAkey rootCA.key -CAcreateserial -out device.crt -days 5000</span><br></pre></td></tr></table></figure><p>执行完以上命令，在ngrok目录下就会新生成6个文件：</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-rw-rw-r-- <span class="number">1</span> lv lv  <span class="number">985</span> Feb <span class="number">17</span> <span class="number">19</span>:<span class="number">04</span> device.crt</span><br><span class="line">-rw-rw-r-- <span class="number">1</span> lv lv  <span class="number">895</span> Feb <span class="number">17</span> <span class="number">19</span>:<span class="number">04</span> device.csr</span><br><span class="line">-rw-rw-r-- <span class="number">1</span> lv lv <span class="number">1679</span> Feb <span class="number">17</span> <span class="number">19</span>:<span class="number">03</span> device.key</span><br><span class="line">-rw-rw-r-- <span class="number">1</span> lv lv <span class="number">1675</span> Feb <span class="number">17</span> <span class="number">19</span>:<span class="number">01</span> rootCA.key</span><br><span class="line">-rw-rw-r-- <span class="number">1</span> lv lv <span class="number">1103</span> Feb <span class="number">17</span> <span class="number">19</span>:<span class="number">03</span> rootCA.pem</span><br><span class="line">-rw-rw-r-- <span class="number">1</span> lv lv   <span class="number">17</span> Feb <span class="number">17</span> <span class="number">19</span>:<span class="number">04</span> rootCA.srl</span><br></pre></td></tr></table></figure><p>ngrok通过bindata将ngrok源码目录下的assets目录（资源文件）打包到可执行文件(ngrokd和ngrok)中 去，assets/client/tls和assets/server/tls下分别存放着用于ngrok和ngrokd的默认证书文件，我们需要将它们替换成我们自己生成的：(因此这一步务必放在编译可执行文件之前)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cp rootCA.pem assets/client/tls/ngrokroot.crt</span><br><span class="line">cp device.crt assets/server/tls/snakeoil.crt</span><br><span class="line">cp device.key assets/server/tls/snakeoil.key</span><br></pre></td></tr></table></figure><h3 id="5-编译客户端程序ngrok和服务端程序ngrokd" class="post-heading"><a href="#5-编译客户端程序ngrok和服务端程序ngrokd" class="headerlink" title="5.编译客户端程序ngrok和服务端程序ngrokd"></a>5.编译客户端程序ngrok和服务端程序ngrokd<a class="post-anchor" href="#5-编译客户端程序ngrok和服务端程序ngrokd" aria-hidden="true"></a></h3><p>在ngrok目录下执行如下命令，编译ngrokd：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ make release-server</span><br></pre></td></tr></table></figure><p>类似的，利用以下命令编译ngrok:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ make release-client</span><br></pre></td></tr></table></figure><p>成功编译后，会在bin目录下找到<code>ngrokd</code>和<code>ngrok</code>这两个文件。</p><p>我们将ngrokd文件拷贝至<code>~/go/bin</code>目录下，以方便在其他目录内也可以直接通过ngrokd来访问该执行程序。</p><h3 id="6-运行ngrokd服务" class="post-heading"><a href="#6-运行ngrokd服务" class="headerlink" title="6.运行ngrokd服务"></a>6.运行ngrokd服务<a class="post-anchor" href="#6-运行ngrokd服务" aria-hidden="true"></a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ngrokd -domain=<span class="string">"ngrok.fex.im"</span> -httpAddr=<span class="string">":8088"</span> -httpsAddr=<span class="string">":8089"</span></span><br><span class="line">[15:08:52 CST 2016/02/18] [INFO] (ngrok/<span class="built_in">log</span>.(*PrefixLogger).Info:83) [registry] [tun] No affinity cache specified</span><br><span class="line">[15:08:52 CST 2016/02/18] [INFO] (ngrok/<span class="built_in">log</span>.(*PrefixLogger).Info:83) [metrics] Reporting every 30 seconds</span><br><span class="line">[15:08:52 CST 2016/02/18] [INFO] (ngrok/log.Info:112) Listening <span class="keyword">for</span> public http connections on [::]:8088</span><br><span class="line">[15:08:52 CST 2016/02/18] [INFO] (ngrok/log.Info:112) Listening <span class="keyword">for</span> public https connections on [::]:8089</span><br><span class="line">[15:08:52 CST 2016/02/18] [INFO] (ngrok/log.Info:112) Listening <span class="keyword">for</span> control and proxy connections on [::]:4443</span><br></pre></td></tr></table></figure><h3 id="7-为ngrok-fex-im添加dns解析" class="post-heading"><a href="#7-为ngrok-fex-im添加dns解析" class="headerlink" title="7.为ngrok.fex.im添加dns解析"></a>7.为ngrok.fex.im添加dns解析<a class="post-anchor" href="#7-为ngrok-fex-im添加dns解析" aria-hidden="true"></a></h3><p>添加两条A记录：<code>ngrok.fex.im</code>和<code>*.ngrok.fex.im</code>，指向fex.im所在的服务器ip。</p><p>至此为止，我们的ngrokd服务端搭建配置完成，同时我们在CentOS系统的服务器上编译了一份客户端的执行程序－一个ngrok文件。<br>如果你的开发机器系统也是CentOS，是可以直接将ngrok这个客户端执行文件拷贝到本地开发机器中来使用的。<br>但如果你的机器是Mac 或者windows，我们还需要在自己的电脑中编译一份相同签名文件的客户端程序！</p><p>注意：请记得提交已更改的源码至github，一会还要用到。</p><h2 id="在MAC中编译ngrok客户端" class="post-heading"><a href="#在MAC中编译ngrok客户端" class="headerlink" title="在MAC中编译ngrok客户端"></a>在MAC中编译ngrok客户端<a class="post-anchor" href="#在MAC中编译ngrok客户端" aria-hidden="true"></a></h2><p>服务器是CentOS，自己的工作电脑是Mac，所以得在自己的电脑中编译一份相同签名文件的客户端程序！</p><h3 id="1-安装go" class="post-heading"><a href="#1-安装go" class="headerlink" title="1.安装go"></a>1.安装go<a class="post-anchor" href="#1-安装go" aria-hidden="true"></a></h3><p>与服务器的步骤类似，我们首先要安装go语言环境：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brew update</span><br><span class="line">brew install go</span><br></pre></td></tr></table></figure><h3 id="2-设置go的环境变量（略）" class="post-heading"><a href="#2-设置go的环境变量（略）" class="headerlink" title="2.设置go的环境变量（略）"></a>2.设置go的环境变量（略）<a class="post-anchor" href="#2-设置go的环境变量（略）" aria-hidden="true"></a></h3><h3 id="3-拉取源码并编译客户端（略）" class="post-heading"><a href="#3-拉取源码并编译客户端（略）" class="headerlink" title="3.拉取源码并编译客户端（略）"></a>3.拉取源码并编译客户端（略）<a class="post-anchor" href="#3-拉取源码并编译客户端（略）" aria-hidden="true"></a></h3><p>最后将编译好的ngrok文件，拷贝至$GOPATH/bin目录内，以便在命令行内任意目录内均可以直接通过ngrok运行程序。</p><h2 id="最后的验证" class="post-heading"><a href="#最后的验证" class="headerlink" title="最后的验证"></a>最后的验证<a class="post-anchor" href="#最后的验证" aria-hidden="true"></a></h2><p>ngrokd服务配置好了，客户端程序也有了，下面测试下ngrok是否能够正常使用。</p><ol><li><p>创建一个ngrok配置文件：ngrok.cfg</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">server_addr: “ngrok.fex.im:4443<span class="string">"</span></span><br><span class="line"><span class="string">trust_host_root_certs: false</span></span><br></pre></td></tr></table></figure></li><li><p>运行客户端，暴露8080端口的站点</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ngrok -subdomain demo -config=/Users/lv/bin/ngrok.cfg 8080</span><br></pre></td></tr></table></figure></li><li><p>在8080端口下建一个测试站点</p><p>方便起见，我们拉取<a href="mailto:git@github.com" target="_blank" rel="noopener">git@github.com</a>:o2team/brand.git做测试：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npm i -g node-static</span><br><span class="line">git <span class="built_in">clone</span> git@github.com:o2team/brand.git</span><br><span class="line"><span class="built_in">cd</span> brand</span><br><span class="line">static</span><br></pre></td></tr></table></figure></li><li><p>在浏览器中输入demo.ngrok.fex.im:8088</p><p>bingo!</p><p><img src="https://img10.360buyimg.com/ling/jfs/t1/36495/29/12573/67953/5d084babEb3dd1d1b/bf53f49b77fb1016.jpg" alt="aotu.io"></p></li><li><p>在浏览器中输入：localhost:4040</p><p>可以查看所有的请求情况！<br><img src="https://img10.360buyimg.com/ling/jfs/t1/54563/16/2710/46427/5d084bc9E84e5e228/92c7342a06da7a14.jpg" alt="aotu.io"></p></li></ol><h2 id="注意事项" class="post-heading"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项<a class="post-anchor" href="#注意事项" aria-hidden="true"></a></h2><p>客户端ngrok.cfg中server_addr后的值必须严格与-domain以及证书中的<code>NGROK_BASE_DOMAIN</code>相同，否则Server端就会出现如下错误日志：</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">03</span>/<span class="number">13</span>/<span class="number">15</span> <span class="number">09</span>:<span class="number">55</span>:<span class="number">46</span>] [INFO] [tun:<span class="number">15</span>dd7522] New connection <span class="keyword">from</span> <span class="number">54.149</span><span class="number">.100</span><span class="number">.42</span>:<span class="number">38252</span></span><br><span class="line">[<span class="number">03</span>/<span class="number">13</span>/<span class="number">15</span> <span class="number">09</span>:<span class="number">55</span>:<span class="number">46</span>] [DEBG] [tun:<span class="number">15</span>dd7522] Waiting to read message</span><br><span class="line">[<span class="number">03</span>/<span class="number">13</span>/<span class="number">15</span> <span class="number">09</span>:<span class="number">55</span>:<span class="number">46</span>] [WARN] [tun:<span class="number">15</span>dd7522] Failed to read message: remote error: bad certificate</span><br><span class="line">[<span class="number">03</span>/<span class="number">13</span>/<span class="number">15</span> <span class="number">09</span>:<span class="number">55</span>:<span class="number">46</span>] [DEBG] [tun:<span class="number">15</span>dd7522] Closing</span><br></pre></td></tr></table></figure><h2 id="参考资料" class="post-heading"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料<a class="post-anchor" href="#参考资料" aria-hidden="true"></a></h2><ul><li>自建ngrok服务</li></ul><ol><li><a href="http://tonybai.com/2015/03/14/selfhost-ngrok-service/" target="_blank" rel="noopener">http://tonybai.com/2015/03/14/selfhost-ngrok-service/</a></li><li><a href="https://github.com/inconshreveable/ngrok/blob/master/docs/SELFHOSTING.md" target="_blank" rel="noopener">https://github.com/inconshreveable/ngrok/blob/master/docs/SELFHOSTING.md</a></li></ol><ul><li>go的安装</li></ul><ol><li><a href="https://blog.starkandwayne.com/2014/12/04/how-to-install-go-on-digital-ocean/" target="_blank" rel="noopener">https://blog.starkandwayne.com/2014/12/04/how-to-install-go-on-digital-ocean/</a></li></ol><h2 id="结语" class="post-heading"><a href="#结语" class="headerlink" title="结语"></a>结语<a class="post-anchor" href="#结语" aria-hidden="true"></a></h2><p>本文主要介绍了ngrok服务的自行搭建。同时为大家免费提供我搭建好的ngrok服务：ngrok.fex.im。<br>fex.im所在的机器是digitalocean的一个主机，虽然国内速度慢但是还算稳定。</p><h2 id="如何使用ngrok-fex-im" class="post-heading"><a href="#如何使用ngrok-fex-im" class="headerlink" title="如何使用ngrok.fex.im?"></a>如何使用ngrok.fex.im?<a class="post-anchor" href="#如何使用ngrok-fex-im" aria-hidden="true"></a></h2><h3 id="安装client" class="post-heading"><a href="#安装client" class="headerlink" title="安装client"></a>安装client<a class="post-anchor" href="#安装client" aria-hidden="true"></a></h3><p>Linux 下载:<a href="http://fex.im/files/ngrok" target="_blank" rel="noopener">http://fex.im/files/ngrok</a><br>Mac OSX 下载：<a href="https://github.com/mamboer/ngrok/releases/download/1.7.2/ngrok" target="_blank" rel="noopener">https://github.com/mamboer/ngrok/releases/download/1.7.2/ngrok</a></p><p>放在 <code>/usr/local/bin</code> 目录下</p><h3 id="设置所有者" class="post-heading"><a href="#设置所有者" class="headerlink" title="设置所有者"></a>设置所有者<a class="post-anchor" href="#设置所有者" aria-hidden="true"></a></h3><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chown <span class="variable">$(</span>whoami)<span class="symbol">:staff</span> ngrok</span><br></pre></td></tr></table></figure><h3 id="设置权限" class="post-heading"><a href="#设置权限" class="headerlink" title="设置权限"></a>设置权限<a class="post-anchor" href="#设置权限" aria-hidden="true"></a></h3><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod <span class="number">777</span> ngrok</span><br></pre></td></tr></table></figure><h3 id="运行客户端" class="post-heading"><a href="#运行客户端" class="headerlink" title="运行客户端"></a>运行客户端<a class="post-anchor" href="#运行客户端" aria-hidden="true"></a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ngrok -subdomain demo -config=/Users/lv/bin/ngrok.cfg 8080</span><br></pre></td></tr></table></figure><h3 id="配置文件" class="post-heading"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件<a class="post-anchor" href="#配置文件" aria-hidden="true"></a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">server_addr: “ngrok.fex.im:4443<span class="string">"</span></span><br><span class="line"><span class="string">trust_host_root_certs: false</span></span><br></pre></td></tr></table></figure><div class="post-tags" style="display:none"><a href="/tags/ngrok/">ngrok</a> <a href="/tags/反向代理/">反向代理</a> <a href="/tags/调试/">调试</a></div><div class="post-categories" style="display:none"><a href="/cates/Web开发/">Web开发</a></div><div class="post-announce">感谢您的阅读，本文由 <a href="//aotu.io">凹凸实验室</a> 版权所有。如若转载，请注明出处：凹凸实验室（<a href="https://aotu.io/notes/2016/02/19/ngrok/">https://aotu.io/notes/2016/02/19/ngrok/</a>）</div><div class="post-revision"><i class="fa fa-clock-o"></i> <time class="post-updated" datetime="2021-02-02T07:48:05.234Z">上次更新：2021-02-02 15:48:05</time></div></div><div class="post-nav"><div class="post-nav-next"><a href="/notes/2016/02/24/node-debug-in-production/" title="Node 生产环境调试">Node 生产环境调试 <i class="fa fa-chevron-right"></i></a></div><div class="post-nav-prev"><a href="/notes/2016/01/28/3xx-of-http-status/" title="你所知道的3xx状态码"><i class="fa fa-chevron-left"></i> 你所知道的3xx状态码</a></div></div><div class="post-comments" id="comments"></div><script>var gitalkOpts={id:"bm90ZXMvMjAxNi8wMi8xOS9uZ3Jvay8=",owner:"o2team",repo:"o2team.github.io",title:"手把手教你搭建ngrok服务－轻松外网调试本机站点",body:"https://aotu.io/notes/2016/02/19/ngrok/index.html\n\nngrok的核心功能：能够将你本机的HTTP服务（站点）或TCP服务，通过部署有ngrok服务的外网伺服器暴露给外网访问！",clientID:"3c4d153e6874260f9c7e",clientSecret:"dd44012504c6168bc05b9266e0554bb28c62ce15",admin:["mamboer"]}</script></article></div><aside class="mod-side" id="sidebar"><div class="mod-side-sec aotuwx"><img class="aotuwx-qrcode" src="/img/qrcode.jpg" alt="关注我们"><div class="aotuwx-slogan">每周推送精选技术文章</div></div><div class="mod-side-sec works"><div class="mod-side-sec-hd"><h2>服务/产品</h2></div><div class="mod-side-sec-bd"><ul class="mod-side-list"><li><a href="//taro.jd.com" target="_blank" title="Taro">Taro</a></li><li><a href="//taro-ui.jd.com" target="_blank" title="Taro-UI">Taro-UI</a></li><li><a href="//taro-ext.jd.com" target="_blank" title="Taro 物料市场">Taro 物料市场</a></li><li><a href="//taro-club.jd.com" target="_blank" title="Taro 官方论坛">Taro 官方论坛</a></li><li><a href="//cases.aotu.io/mobi/maga.html" target="_blank" title="拇指期刊">拇指期刊</a></li><li><a href="//athena.aotu.io/" target="_blank" title="Athena">Athena</a></li><li><a href="//guide.aotu.io/" target="_blank" title="前端代码规范">前端代码规范</a></li><li><a href="//halojs.aotu.io/" target="_blank" title="HaloJS">HaloJS</a></li><li><a href="//sign.aotu.io/" target="_blank" title="邮件签名工具">邮件签名工具</a></li><li><a href="//mac.aotu.io/" target="_blank" title="MAC全栈环境">MAC全栈环境</a></li><li><a href="//xcel.aotu.io" target="_blank" title="Excel Filter">Excel Filter</a></li><li><a href="//aotu.jd.com/share/" target="_blank" title="凹凸公开课">凹凸公开课</a></li><li><a href="//at.aotu.io" target="_blank" title="AT-UI">AT-UI</a></li></ul></div></div><div class="mod-side-sec favlinks"><div class="mod-side-sec-hd"><h2>友情链接</h2></div><div class="mod-side-sec-bd"><ul class="mod-side-list"><li><a href="https://www.cloudbase.net" target="_blank" title="小程序·云开发"><img style="width:22px;vertical-align:middle" src="https://img20.360buyimg.com/ling/jfs/t1/57175/5/15617/50216/5dca6729E00cdff5d/631622525425290e.png">小程序·云开发</a></li><li><a href="https://ling.jd.com" target="_blank" title="京东羚珑智能设计">羚珑智能设计</a></li><li><a href="https://jdrd.jd.com" target="_blank" title="京东零售设计服务平台">京东零售设计服务平台</a></li><li><a href="https://jdc.jd.com" target="_blank" title="京东设计中心">JDC京东设计中心</a></li><li><a href="http://dopro.io/" target="_blank" title="腾讯 Deep Ocean">Deep Ocean</a></li><li><a href="http://fex.baidu.com" target="_blank" title="百度Web前端研发部">百度FEX</a></li><li><a href="http://taobaofed.org" target="_blank" title="淘宝前端团队">淘宝FED</a></li><li><a href="http://tgideas.qq.com" target="_blank" title="腾讯互娱设计中心">TGIdeas</a></li><li><a href="http://isux.tencent.com" target="_blank" title="腾讯SNG设计中心">ISUX</a></li><li><a href="http://cdc.tencent.com" target="_blank" title="腾讯用户研究与体验设计中心">CDC</a></li><li><a href="http://ued.ctrip.com" target="_blank" title="携程设计委员会">携程UED</a></li><li><a href="https://uiiiuiii.com/" target="_blank" title="优优教程网">优优教程网</a></li><li><a href="https://www.designup.cn/" target="_blank" title="Designup">Designup</a></li><li><a href="http://eux.baidu.com/" target="_blank" title="百度EUX">百度EUX</a></li></ul></div></div></aside></div></div><div class="mod-backtop" id="backTop"><i class="fa fa-long-arrow-up"></i></div><footer class="mod-ft" id="footer"><div class="grid"><ul class="mod-ft-links"><li><a href="/atom.xml"><i class="fa fa-rss"></i></a></li><li><a href="https://github.com/o2team/o2team.github.io" target="_blank"><i class="fa fa-github-alt"></i></a></li></ul><div class="mod-ft-sec mod-ft-copyright"><p>Designed by <a href="http://aotu.io" target="_blank">凹凸实验室</a> @<a target="_blank" href="http://jdc.jd.com">京东用户体验设计部</a></p><p>Copyright &copy; 2021. All Rights Reserved.</p><p><a href="https://beian.miit.gov.cn/" target="_blank">粤ICP备15077732号-2</a></p></div></div></footer><script src="/js/bundle/core.js"></script><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script><script src="/js/post_wx_share.js"></script><script src="/js/bundle/gitalk.js"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?e850b980d029480b092fdd7503c3f8de";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script type="text/javascript" src="https://tajs.qq.com/stats?sId=53685723" charset="UTF-8"></script></body></html>